// Instrumentation file for Next.js 14+
// This file is automatically loaded by Next.js before your application starts
// Used to initialize Sentry and other monitoring tools

export async function register() {
  // Only initialize Sentry in production
  // Development uses separate sentry.*.config.ts files
  if (process.env.NODE_ENV === 'production' && process.env.NEXT_PUBLIC_SENTRY_DSN) {
    try {
      if (process.env.NEXT_RUNTIME === 'nodejs') {
        // Server-side initialization
        const { init } = await import('@sentry/nextjs');

        init({
          dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
          tracesSampleRate: 0.1,
          environment: process.env.NEXT_PUBLIC_SENTRY_ENVIRONMENT || 'production',
          enabled: true,

          // Ignore common errors
          ignoreErrors: [
            'ResizeObserver loop limit exceeded',
            'Non-Error promise rejection captured',
            'ResizeObserver loop completed with undelivered notifications',
            'Network request failed',
            'NetworkError',
            'Failed to fetch',
          ],
        });
      }

      if (process.env.NEXT_RUNTIME === 'edge') {
        // Edge runtime initialization
        const { init } = await import('@sentry/nextjs');

        init({
          dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
          tracesSampleRate: 0.1,
          environment: process.env.NEXT_PUBLIC_SENTRY_ENVIRONMENT || 'production',
          enabled: true,
        });
      }
    } catch (error) {
      console.error('Failed to initialize Sentry:', error);
    }
  }
}
