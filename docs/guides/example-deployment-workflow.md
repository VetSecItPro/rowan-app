# Example: Next Claude Code Session Workflow

## üöÄ **Exact Commands Claude Code Will Run**

### **Phase 1: Claude Code Preparation (Local)**

```bash
# 1. Claude Code reads the migration guide
cat hostinger_migration.md

# 2. Generates optimized configs for your 2 vCPU/8GB VPS
mkdir -p deployment/{configs,scripts,monitoring}

# 3. Creates Nginx config optimized for your resources
cat > deployment/configs/nginx.conf << 'EOF'
# Generated by Claude Code - Optimized for 2 vCPU/8GB RAM
worker_processes 2;  # Match your CPU cores
worker_connections 1024;
worker_rlimit_nofile 2048;

# Optimized for your 8GB RAM
worker_rlimit_core 2G;
# ... (rest of optimized config)
EOF

# 4. Creates PM2 config with memory optimization
cat > deployment/configs/ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'rowan-app',
    instances: 2,  // Perfect for your 2 vCPU
    max_memory_restart: '3G',  // 3GB per instance (6GB total)
    node_args: '--max-old-space-size=3072',
    // ... (rest of config)
  }]
};
EOF

# 5. Creates master deployment script
cat > deployment/scripts/setup-vps.sh << 'EOF'
#!/bin/bash
# Master setup script - handles everything automatically
set -e

echo "üöÄ Starting automated VPS setup..."

# Install Node.js, PM2, Nginx
./install-dependencies.sh

# Configure security
./security-hardening.sh

# Deploy application
./deploy-application.sh

# Setup monitoring
./monitoring-setup.sh

echo "‚úÖ Deployment complete!"
EOF

# 6. Tests build locally first
npm run build
echo "‚úÖ Local build successful - ready for VPS deployment"

# 7. Creates deployment package
tar -czf deployment-package.tar.gz deployment/ .env.local package.json package-lock.json
echo "üì¶ Deployment package created: deployment-package.tar.gz"
```

### **Phase 2: Your Execution (3 Commands Total)**

```bash
# Command 1: Transfer to VPS
scp deployment-package.tar.gz root@YOUR_VPS_IP:/root/

# Command 2: Execute automated setup
ssh root@YOUR_VPS_IP "
  tar -xzf deployment-package.tar.gz &&
  cd deployment &&
  chmod +x scripts/*.sh &&
  ./scripts/setup-vps.sh
"

# Command 3: Verify (Claude Code provides these)
curl -I https://your-domain.com/health
```

### **Phase 3: Claude Code Verification (Remote Commands)**

```bash
# Claude Code will provide you these verification commands:

# Check application status
ssh root@YOUR_VPS_IP "pm2 status"

# Verify memory optimization
ssh root@YOUR_VPS_IP "pm2 monit"

# Test 2FA functionality
curl -I https://your-domain.com/settings

# Performance check
ssh root@YOUR_VPS_IP "./monitoring/performance-report.sh"
```

---

## üîß **Real Example: Memory Optimization Script**

Claude Code will generate scripts like this:

```bash
# auto-optimize-memory.sh - Generated by Claude Code
#!/bin/bash

TOTAL_RAM=8  # Your VPS has 8GB
CURRENT_USAGE=$(free | grep Mem | awk '{printf("%.0f", ($3/$2) * 100)}')

echo "Current memory usage: ${CURRENT_USAGE}%"

if [ $CURRENT_USAGE -gt 85 ]; then
    echo "High memory usage detected - scaling down PM2 instances"
    pm2 scale rowan-app 1
    echo "Scaled to 1 instance to preserve system stability"

elif [ $CURRENT_USAGE -lt 60 ]; then
    CURRENT_INSTANCES=$(pm2 jlist | jq length)
    if [ $CURRENT_INSTANCES -lt 2 ]; then
        echo "Memory available - scaling up to utilize both CPU cores"
        pm2 scale rowan-app 2
        echo "Scaled to 2 instances for optimal performance"
    fi
fi

# Log the optimization
echo "$(date): Memory optimization completed - Usage: ${CURRENT_USAGE}%" >> /var/log/rowan-optimization.log
```

---

## üìä **Performance Monitoring Dashboard**

Claude Code will create monitoring commands you can run anytime:

```bash
# System overview
ssh root@YOUR_VPS_IP "
  echo '=== ROWAN APP STATUS ==='
  pm2 status
  echo
  echo '=== RESOURCE USAGE ==='
  echo 'CPU:' \$(top -bn1 | grep 'Cpu(s)' | awk '{print \$2}')
  echo 'Memory:' \$(free | grep Mem | awk '{printf(\"%.1f%%\", (\$3/\$2) * 100.0)}')
  echo 'Disk:' \$(df -h / | awk 'NR==2 {print \$5}')
  echo
  echo '=== NGINX STATUS ==='
  systemctl status nginx --no-pager -l
"
```

---

## üîÑ **Ongoing Updates (Future Sessions)**

For app updates, Claude Code will create:

```bash
# update-app.sh - One command deployment
#!/bin/bash
set -e

echo "üîÑ Updating Rowan App..."

# Backup current version
pm2 save
cp ecosystem.config.js ecosystem.config.js.backup

# Pull and build new version
git pull origin main
npm ci
npm run build

# Deploy with zero downtime
pm2 reload rowan-app

# Verify deployment
sleep 5
if curl -f http://localhost:3000/health > /dev/null 2>&1; then
    echo "‚úÖ Update successful!"
    rm ecosystem.config.js.backup
else
    echo "‚ùå Update failed - rolling back"
    pm2 stop rowan-app
    git reset --hard HEAD^
    mv ecosystem.config.js.backup ecosystem.config.js
    npm ci && npm run build
    pm2 restart rowan-app
    exit 1
fi
```

Then you just run: `./update-app.sh` on your VPS!

---

## üéØ **What This Achieves**

### **Maximum Automation:**
- **90% automated** - Most work done by scripts
- **Zero downtime** deployments
- **Automatic rollback** if anything fails
- **Self-healing** monitoring

### **Optimized for Your Hardware:**
- **2 PM2 instances** for your 2 vCPU cores
- **3GB RAM per instance** (6GB total, 2GB for system)
- **Nginx workers tuned** for your CPU count
- **Kernel parameters optimized** for 8GB RAM

### **Production Ready:**
- **SSL automation** with Let's Encrypt
- **Security hardening** with firewall rules
- **Performance monitoring** with alerts
- **Backup automation** with rotation

### **Future-Proof Scaling:**
- **Monitoring thresholds** to alert when upgrade needed
- **Scaling scripts** ready for larger VPS
- **Migration automation** for growth

---

## üìã **Next Claude Code Session Checklist**

When you start the next session, Claude Code will:

1. ‚úÖ **Read both migration guides** (hostinger_migration.md + deployment-automation.md)
2. ‚úÖ **Generate all config files** optimized for your exact VPS specs
3. ‚úÖ **Create deployment scripts** with error handling
4. ‚úÖ **Test build locally** before any VPS work
5. ‚úÖ **Package everything** into single deployment bundle
6. ‚úÖ **Provide exact commands** for you to run (3 total)
7. ‚úÖ **Create monitoring dashboard** for ongoing management
8. ‚úÖ **Set up update automation** for future deployments

**Your effort:** Run 3 commands total, then you have a production-ready VPS!

**Result:** Your Rowan app running on optimized VPS infrastructure with monitoring, auto-scaling, security, and easy updates!